<div class="p-4">
  <h2 class="text-2xl font-semibold mb-4">Ride Analytics</h2>

  <div class="flex gap-2 items-center mb-3">
    <label class="flex items-center gap-2">From <input class="border rounded px-2 py-1" type="date" [(ngModel)]="startDate" /></label>
    <label class="flex items-center gap-2">To <input class="border rounded px-2 py-1" type="date" [(ngModel)]="endDate" /></label>
    <button class="bg-[#C5E55D] text-white px-3 py-1 border border-[#C5E55D] rounded-md cursor-pointer" (click)="applyRange()">Apply</button>

    @if (userRole === 'ADMIN') {
      <div class="ml-4 flex gap-2 items-center">
        <label>
          <select class="border rounded px-2 py-1" [(ngModel)]="selectedRoleFilter">
            <option [ngValue]="null">Select view</option>
            <option [ngValue]="'ALL_DRIVERS'">All drivers</option>
            <option [ngValue]="'ALL_PASSENGERS'">All passengers</option>
          </select>
        </label>
        <label>
          <input class="border rounded px-2 py-1" placeholder="User id (optional)" [(ngModel)]="selectedUserId" />
        </label>
      </div>
    }

  </div>

  <div class="flex gap-3 mt-3">
    <div class="bg-white border rounded-md p-3 min-w-37.5 shadow-sm">
      <div class="text-sm text-gray-500">Total rides</div>
      <div class="text-xl font-bold">{{ totals.rides }}</div>
      <div class="text-sm text-gray-600">Avg / day: {{ avgRides }}</div>
    </div>
    <div class="bg-white border rounded-md p-3 min-w-37.5 shadow-sm">
      <div class="text-sm text-gray-500">Total kilometers</div>
      <div class="text-xl font-bold">{{ totals.kilometers | number:'1.0-2' }}</div>
      <div class="text-sm text-gray-600">Avg / day: {{ avgKm | number:'1.0-2' }}</div>
    </div>
    <div class="bg-white border rounded-md p-3 min-w-37.5 shadow-sm">
      <div class="text-sm text-gray-500">Total money</div>
      <div class="text-xl font-bold">{{ totals.money | number:'1.0-2' }}</div>
      <div class="text-sm text-gray-600">Avg / day: {{ avgMoney | number:'1.0-2' }}</div>
    </div>
  </div>

  <div class="flex gap-3 mt-4">
    <div class="flex-1 bg-white p-3 rounded-md border shadow-sm">
      <h3 class="text-lg font-medium mb-2">Rides / day</h3>
      @if (labels.length) {
        <ng-container>
          <div class="h-80">
            <canvas baseChart
                    [data]="ridesChartData"
                    [options]="lineChartOptions"
                    [type]="'line'">
            </canvas>
          </div>
        </ng-container>
      }
    </div>

    <div class="flex-1 bg-white p-3 rounded-md border shadow-sm">
      <h3 class="text-lg font-medium mb-2">Kilometers / day</h3>
      @if (labels.length) {
        <ng-container>
          <div class="h-80">
            <canvas baseChart
                    [data]="kmChartData"
                    [options]="lineChartOptions"
                    [type]="'line'">
            </canvas>
          </div>
        </ng-container>
      }
    </div>

    <div class="flex-1 bg-white p-3 rounded-md border shadow-sm">
      <h3 class="text-lg font-medium mb-2">Money / day</h3>
      @if (labels.length) {
        <ng-container>
          <div class="h-80">
            <canvas baseChart
              [data]="moneyChartData"
              [options]="lineChartOptions"
              [type]="'line'">
            </canvas>
          </div>
        </ng-container>
      }
    </div>
  </div>

  @if (loading) {
    <div class="mt-3 text-gray-600">Loading...</div>
  }
  @if (error) {
    <div class="mt-3 text-red-600">{{ error }}</div>
  }

</div>

